<!DOCTYPE html>
{% load static %}
<html>
  <head>
    <title>Search Patents</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="{% static 'CSS/index.css' %}" rel="stylesheet" />
    <style>
      .modal-body form ul {
        display: none;
      }
      .helptext {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="container mt-5">
      <!-- 注册和登录按钮 -->
      <div class="d-flex justify-content-end">
        <div class="register-login mb-3">
          {% if user.is_authenticated %}
          <span class="me-2">你好，{{ user.username }}！</span>
          <form
            action="{% url 'logout' %}"
            method="post"
            style="display: inline"
          >
            {% csrf_token %}
            <button type="submit" class="btn btn-secondary">登出</button>
          </form>
          {% else %}
          <!-- 如果用户未登录，显示注册和登录按钮 -->
          <button
            type="button"
            class="btn btn-primary me-2"
            data-bs-toggle="modal"
            data-bs-target="#registerModal"
          >
            注册
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-toggle="modal"
            data-bs-target="#loginModal"
          >
            登录
          </button>
          {% endif %}
        </div>
      </div>

      {% if messages %} {% for message in messages %}
      <div class="alert {{ message.tags }}">{{ message }}</div>
      {% endfor %} {% endif %}

      <h1 class="mb-4">搜索专利</h1>
      <form method="get" action="{% url 'patent_list' %}" class="form-inline">
        <div class="input-group mb-3">
          <input
            type="text"
            name="q"
            class="form-control"
            placeholder="Enter search terms"
          />
          <button type="submit" class="btn btn-primary" id="search-btn">
            搜索
          </button>
        </div>
      </form>

      <!-- Register -->
      <div
        class="modal fade"
        id="registerModal"
        tabindex="-1"
        aria-labelledby="registerModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="registerModalLabel">注册新用户</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form method="post" action="{% url 'index' %}">
                {% csrf_token %} {{ register_form.as_p }}
                <button
                  type="submit"
                  name="register_form"
                  class="btn btn-primary mt-3"
                >
                  注册
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Login -->
      <div
        class="modal fade"
        id="loginModal"
        tabindex="-1"
        aria-labelledby="loginModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="loginModalLabel">用户登录</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form method="post" action="{% url 'index' %}">
                {% csrf_token %} {{ login_form.as_p }}
                <button
                  type="submit"
                  name="login_form"
                  class="btn btn-primary mt-3"
                >
                  登录
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document
        .getElementById('search-btn')
        .addEventListener('click', function () {
          localStorage.clear()
        })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
